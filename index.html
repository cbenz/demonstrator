<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>OpenFisca Demonstrator</title>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <meta content="IE=edge" http-equiv=X-UA-Compatible>
    <meta content="width=device-width,initial-scale=1" name=viewport>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="http://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="http://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="/waterfall.css">
</head>

<body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="/waterfall.js"></script>
    <script src="/_compile/src/Main.elm"></script>
    <script>
        var app = runElmProgram();

        // Waterfall
        var requestAnimationFrame = typeof window.requestAnimationFrame !== 'undefined'
            ? window.requestAnimationFrame
            : function (callback) { setTimeout(function () { callback(); }, 0); };
        function waterfallYFormatter(n) {
            n = Math.round(n)
            var result = n
            if (Math.abs(n) > 999) {
                result = Math.round(n / 1000) + 'K'
            }
            // TODO Do not hardcode currency
            return result + ' â‚¬'
        }
        function renderWaterfall(options) {
            var waterfallSelector = "#waterfall";
            var waterfallElement = document.querySelector(waterfallSelector);
            if (waterfallElement) {
                var svgElement = waterfallElement.querySelector("svg");
                if (svgElement) {
                    svgElement.parentNode.removeChild(svgElement);
                }
                var defaultOptions = {
                    elementSelector: waterfallSelector,
                    viewPort: {
                        height: waterfallElement.clientWidth * 0.5,
                        width: waterfallElement.clientWidth
                    },
                    yFormatter: waterfallYFormatter
                };
                waterfallChart(Object.assign(defaultOptions, options));
            }
        }
        app.ports.renderWaterfall.subscribe(function (options) {
            window.onresize = function (event) {
                renderWaterfall(options);
            };
            // Use requestAnimationFrame to render the chart after the Elm view is rendered.
            requestAnimationFrame(function () {
                renderWaterfall(options);
            });
        });
    </script>
</body>

</html>